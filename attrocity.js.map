{"version":3,"file":"attrocity.js","sources":["src/map.js","src/reflect.js"],"sourcesContent":["export default class Map {\n    /**\n     * defaults\n     * @returns {{attribute: string, root: string}}\n     */\n    static get mapdefaults() {\n        return {\n            attribute: 'map',\n            root: 'maproot'\n        }\n    };\n\n    /**\n     * defaults\n     * @returns {{attribute: string, root: string}}\n     */\n    static get wiredefaults() {\n        return {\n            attribute: 'wire',\n            root: 'maproot'\n        }\n    };\n\n    /**\n     * generate attribute selector for query selection\n     * @param name\n     * @returns {string}\n     */\n    static _attributeSelector(name) { return '[' + name + ']'; };\n\n    /**\n     * map dom elements with desired attribute to object\n     * @param node\n     * @param startingObj\n     * @param opts\n     */\n    static map(node, startingObj, opts) {\n        opts = Object.assign(this.mapdefaults, opts ? opts : {} );\n        const selector = this._attributeSelector(opts.attribute);\n\n        let domcache = startingObj ? startingObj : {};\n        let els = node.querySelectorAll(selector);\n        let rootlevelEls = node.querySelectorAll(this._attributeSelector(opts.root));\n\n        els = this._filterElementsContainedByRoot(els, rootlevelEls);\n\n        for (let e = 0; e < els.length; e++) {\n            let path = els[e].getAttribute(opts.attribute).split('.');\n            const prop = path.pop();\n            const deepref = this._ensurePropertyPath(domcache, path);\n            this._setProperty(deepref, prop, els[e]);\n\n        }\n        return domcache;\n    };\n\n    static wire(node, callback, scope, opts) {\n        opts = Object.assign(this.wiredefaults, opts ? opts : {} );\n        const selector = this._attributeSelector(opts.attribute);\n        let els = node.querySelectorAll(selector);\n        let rootlevelEls = node.querySelectorAll(this._attributeSelector(opts.root));\n\n        els = this._filterElementsContainedByRoot(els, rootlevelEls);\n        for (let e = 0; e < els.length; e++) {\n            const eventtypes = els[e].getAttribute(opts.attribute).split(',');\n            for (let c = 0; c < eventtypes.length; c++) {\n                els[e].addEventListener(eventtypes[c], e => { callback.apply(scope, [e]) });\n            }\n        }\n    }\n\n    static wireElements(els, events, callback, scope) {\n        if (!Array.isArray(els)) {\n            els =  [els];\n        }\n        let eventtypes = events;\n        if (!Array.isArray(events)) {\n            eventtypes = eventtypes.split(',');\n        }\n        for (let d = 0; d < els.length; d++) {\n            for (let c = 0; c < eventtypes.length; c++) {\n                els[d].addEventListener(eventtypes[c].trim(), e => { callback.apply(scope, [e]) });\n            }\n        }\n    }\n\n    /**\n     * ensure deep or shallow path exists on object\n     * @param obj\n     * @param propslist\n     * @return deep reference\n     */\n    static _ensurePropertyPath(obj, propslist) {\n        propslist = propslist.reverse();\n        let parent;\n        let parentProp;\n        while (propslist.length > 0) {\n            const prop = propslist.pop();\n            if (!obj[prop]) {\n                obj[prop] = {};\n            }\n            parent = obj;\n            obj = obj[prop];\n            parentProp = prop;\n        }\n        return { current: obj, parent: parent, parentProp: parentProp };\n    }\n\n    /**\n     * set property on object\n     * @param obj\n     * @param prop\n     * @param val\n     * @private\n     */\n    static _setProperty(obj, prop, val) {\n        let ref = obj.current;\n        let parent = obj.parent;\n        let parentProp = obj.parentProp;\n        if (!ref[prop]) {\n            // element already set on prop, but we're adding more key/values to it as an object\n            // roll back to parent and set object that can hold all\n            if (ref instanceof Element) {\n                parent[parentProp] = {};\n                parent[parentProp][parentProp] = ref;\n                parent[parentProp][prop] = val;\n            } else {\n                ref[prop] = val;\n            }\n        } else if (ref[prop] instanceof Element) {\n            // element already exists on key, turn into array holding list\n            ref[prop] = [ ref[prop] ];\n            ref[prop].push(val);\n        } else if (Array.isArray(ref[prop])) {\n            ref[prop].push(val);\n        } else if (Object.keys(ref[prop]).length > 0) {\n            // key being set is already an object containing keys, bump this key further down the chain\n            ref[prop][prop] = val;\n        }\n    }\n\n    /**\n     * remove elements contained by marked roots\n     * @param els\n     * @param roots\n     * @returns {Array}\n     */\n    static _filterElementsContainedByRoot(els, roots) {\n        const nondeepEls = [];\n        for (let e = 0; e < els.length; e++) {\n            let elIsContainedByRoot = false;\n            for (let d = 0; d < roots.length; d++) {\n                if (roots[d] !== els[e] && roots[d].contains(els[e])) {\n                    elIsContainedByRoot = true;\n                }\n            }\n            if (!elIsContainedByRoot) {\n                nondeepEls.push(els[e]);\n            }\n        }\n        return nondeepEls;\n    }\n}\n","export default class Reflect {\n    static attach(clazz, changeCallbackFnName) {\n        if (!changeCallbackFnName) {\n            changeCallbackFnName = 'propertyChangedCallback';\n        }\n        const props = clazz.observedAttributes;\n        if (props) {\n            for (let c = 0; c < props.length; c++) {\n                Object.defineProperty(clazz.prototype, props[c], {\n                    set: function (val) {\n                        const old = this.getAttribute(props[c]);\n                        this.setAttribute(props[c], val);\n                        if (this[changeCallbackFnName]) {\n                            this[changeCallbackFnName](props[c], old, val);\n                        }\n                    },\n\n                    get: function () {\n                        return this.getAttribute(props[c]);\n                    }\n                });\n            }\n\n            clazz.prototype.attributeChangedCallback = function(name, oldval, newval) {\n                this[changeCallbackFnName](name, oldval, newval);\n            }\n        } else {\n            console.warn( clazz.constructor, 'No attributes for reflection specified in the observedAttributes static getter')\n        }\n        return clazz;\n    }\n}\n"],"names":[],"mappings":"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"}